<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>AspectCore Project &#20171;&#32461; </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="AspectCore Project &#20171;&#32461; ">
    <meta name="generator" content="docfx 2.11.2.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
                  </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
              <h2 id="aspectcore-project-介绍">AspectCore Project 介绍</h2>
              
<h3 id="什么是aspectcore-project-">什么是AspectCore Project ?</h3>
<p><a href="https://github.com/aspectcore">AspectCore Project</a> 是适用于<a href="https://docs.microsoft.com/en-us/aspnet/core/">Asp.Net Core</a> 平台的轻量级 <a href="https://en.wikipedia.org/wiki/Aspect-oriented_programming">Aop(Aspect-oriented programming)</a> 解决方案，它更好的遵循Asp.Net Core的模块化开发理念，使用AspectCore可以更容易构建低耦合、易扩展的Web应用程序。</p>
<h3 id="为什么要设计aspectcore-">为什么要设计AspectCore ?</h3>
<p>在传统.Net Framework和Asp.Net Framework中，我们使用<a href="https://github.com/castleproject/Core/blob/master/docs/dynamicproxy.md">Castle DynamicProxy</a> 或者CLR提供的 <a href="https://msdn.microsoft.com/en-us/library/system.runtime.remoting.proxies.aspx">Remoting.Proxies</a>  可以轻松的实现 Aop 来分离关注点从而降低业务逻辑和基础框架功能的耦合。然而在Asp.Net Core中，不仅缺乏细粒度的Aop支持(<code>Middleware</code>和<code>Filter</code>都是Asp.Net Core的内置Aop实现，但仅适合在Web层使用)，Castle也迟迟未能友好的支持Asp.Net Core。</p>
<p>因此 AspectCore 提供了一个全新的轻量级和模块化的Aop解决方案，下面是AspectCore的基本特性：</p>
<ul>
<li>提供抽象的Aop接口，基于该接口，可以轻松的使用自己的代理类实现替换默认的实现</li>
<li>框架不包含IoC，也不依赖具体的IoC实现，可以使用Asp.Net Core的<a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection">内置依赖注入</a>或任何兼容 Asp.Net Core的第三方IoC来集成 AspectCore 到 Asp.Net Core 应用程序中</li>
<li>高性能的异步拦截器系统</li>
<li>灵活的配置系统</li>
<li>基于<code>Service</code>的而非基于实现类的切面构造</li>
<li>支持跨平台的Asp.Net Core环境</li>
</ul>
<h3 id="aspectcore-project-架构设计">AspectCore Project 架构设计</h3>
<p><img src="/images/aspectcofe-architecture.png" alt="深入理解C#" height="320"></p>
<p>从上图可以看出，<a href="https://github.com/AspectCore/Abstractions">AspectCore Abstractions</a> 是AspectCore Project的核心，向下通过IoC来集成到Asp.Net Core应用程序中，向上提供配置系统，动态代理系统，模型验证系统以及更多的扩展系统。</p>
<p>目前已完成的组件包括：</p>
<ul>
<li><a href="http://www.nuget.org/packages/AspectCore.Abstractions/">AspectCore.Abstractions</a> 提供Aop的抽象接口</li>
<li><a href="http://www.nuget.org/packages/AspectCore.Container.DependencyInjection/">AspectCore.Container.DependencyInjection</a> AspectCore的DependencyInjection支持</li>
<li><a href="https://www.nuget.org/packages/AspectCore.Container.Autofac/">AspectCore.Container.Autofac</a> AspectCore的Autofac支持</li>
<li><a href="https://www.nuget.org/packages/AspectCore.Extensions.Configuration/">AspectCore.Extensions.Configuration</a> AspectCore的配置系统</li>
<li><a href="https://www.nuget.org/packages/AspectCore.Extensions.Configuration.Files/">AspectCore.Extensions.Configuration.Files</a> AspectCore的配置文件支持</li>
<li><a href="https://www.nuget.org/packages/AspectCore.Extensions.DynamicProxy/">AspectCore.Extensions.DynamicProxy</a> AspectCore 动态代理</li>
</ul>
<h3 id="在aspnet-core应用程序中开始使用aspectcore">在Asp.Net Core应用程序中开始使用AspectCore</h3>
<ol>
<li>启动 Visual Studio。从 File 菜单, 选择 New &gt; Project。选择 ASP.NET Core Web Application 项目模版，创建新的 ASP.NET Core Web Application 项目。</li>
<li><p>从 Nuget 安装 AspectCore.Lite.Container.DependencyInjection package:</p>
<pre><code> PM&gt;   Install-Package AspectCore.Container.DependencyInjection -Pre
</code></pre></li>
<li><p>在拦截器系统中，AspectCore定义了<code>IInterceptor</code>接口，它声明了一个返回值为Task的异步执行方法：</p>
<pre><code> namespace AspectCore.Lite.Abstractions
 {
     public interface IInterceptor
     {   
         Task Invoke(IAspectContext context, AspectDelegate next);
     }
 }
</code></pre><p> 然而在一般情况下可以使用另一个抽象的<code>InterceptorAttribute</code>自定义特性类，它实现<code>IInterceptor</code>接口。AspectCore默认实现了基于<code>Attribute</code>的拦截器配置。我们的自定义拦截器看起来像下面这样:</p>
<pre><code> public class CustomInterceptorAttribute : InterceptorAttribute
 {
     public async override Task Invoke(IAspectContext context, AspectDelegate next)
     {
         try
         {
             Console.WriteLine(&quot;Before service call&quot;);
             await next(context);
         }
         catch (Exception)
         {
             Console.WriteLine(&quot;Service threw an exception!&quot;);
             throw;
         }
         finally
         {
             Console.WriteLine(&quot;After service call&quot;);
         }
      }
  }
</code></pre></li>
<li><p>定义<code>ICustomService</code>接口和它的实现类<code>CustomService</code>:</p>
<pre><code> public interface ICustomService
 {
     [CustomInterceptor]
     void Call();
 }

 public class CustomService : ICustomService
 {
     public void Call()
     {
         Console.WriteLine(&quot;service calling...&quot;);
     }
 }
</code></pre></li>
<li><p>在<code>HomeController</code>中注入<code>ICustomService</code>:</p>
<pre><code> public class HomeController : Controller
 {
     private readonly ICustomService _service;
     public HomeController(ICustomService service)
     {
         _service = service;
     }

     public IActionResult Index()
     {
         _service.Call();
         return View();
     }
 }
</code></pre></li>
<li><p>注册<code>ICustomService</code>，接着，在<code>ConfigureServices</code>中配置创建代理类型的容器:</p>
<pre><code> public IServiceProvider ConfigureServices(IServiceCollection services)
 {
     services.AddTransient&lt;ICustomService, CustomService&gt;();

     services.AddMvc();

     return new AspectCoreServiceProviderFactory().CreateServiceProvider(services);
 }
</code></pre></li>
</ol>
<h3 id="有问题反馈">有问题反馈</h3>
<p>如果您有任何问题，请提交 <a href="https://github.com/AspectCore/Lite.Abstractions/issues/new">Issue</a> 给我们。</p>

            </article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/AspectCore/docs/blob/master/doc/intro.md/#L1" class="contribution-link">&#25913;&#21892;&#27492;&#25991;&#26723;</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2015-2016 Microsoft<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
